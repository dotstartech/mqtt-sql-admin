<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT SQL Admin</title>
    <link id="favicon" rel="icon" type="image/png" href="">
    <link rel="stylesheet" href="/admin/styles.css">
    <script src="https://unpkg.com/mqtt@5.10.1/dist/mqtt.min.js"></script>
    <script src="/admin/app.js" defer></script>
</head>
<body>
    <div class="container">
        <header>
            <img id="headerLogo" class="header-logo" src="" alt="Logo" style="display: none;">
            <h1 id="headerTitle">MQTT SQL Admin</h1>
            <div class="settings-wrapper">
                <button id="authButton" class="auth-btn" onclick="handleAuthButtonClick()" title="Login">Login</button>
                <button class="settings-btn" onclick="toggleSettingsMenu()" title="Settings">‚ò∞</button>
                <!-- Settings Dropdown Menu -->
                <div id="settingsMenu" class="settings-menu">
                    <div class="menu-item menu-item-row">
                        <span>Theme</span>
                        <div class="theme-toggle">
                            <span id="themeLabelDark" class="theme-toggle-label active">Dark</span>
                            <div id="themeSlider" class="theme-slider" onclick="toggleTheme()">
                                <div class="theme-slider-knob"></div>
                            </div>
                            <span id="themeLabelLight" class="theme-toggle-label">Light</span>
                        </div>
                    </div>
                    <div class="menu-item menu-item-row">
                        <span>Font</span>
                        <select id="fontSelect" onchange="selectFont(this.value)">
                            <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
                            <option value="'Fira Code', monospace">Fira Code</option>
                            <option value="'Courier New', monospace">Courier New</option>
                            <option value="'Segoe UI', sans-serif">Segoe UI</option>
                            <option value="'Roboto', sans-serif">Roboto</option>
                        </select>
                    </div>
                    <div class="menu-separator"></div>
                    <div id="authMenuItem" class="menu-item" onclick="handleAuthMenuClick()">
                        Login
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-item" onclick="openAboutModal()">
                        About
                    </div>
                </div>
            </div>
        </header>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="modal-overlay" onclick="closeConfirmOnOverlay(event)">
            <div class="modal-content confirm-modal">
                <div class="modal-header">
                    <h2>Confirm Delete</h2>
                    <button class="modal-close" onclick="closeConfirmModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <p id="confirmMessage"></p>
                    <div class="modal-buttons">
                        <button class="modal-btn modal-btn-cancel" onclick="closeConfirmModal()">Cancel</button>
                        <button class="modal-btn modal-btn-confirm" onclick="confirmModalAction()">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="modal-overlay">
            <div class="modal-content login-modal">
                <div class="modal-header">
                    <h2>üîê Login</h2>
                </div>
                <div class="modal-body">
                    <form id="loginForm" onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label for="loginUsername">Username</label>
                            <input type="text" id="loginUsername" name="username" autocomplete="username" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" name="password" autocomplete="current-password" required>
                        </div>
                        <div id="loginError" class="login-error"></div>
                        <div class="modal-buttons">
                            <button type="submit" class="modal-btn modal-btn-login">Login</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- About Modal -->
        <div id="aboutModal" class="modal-overlay" onclick="closeAboutOnOverlay(event)">
            <div class="modal-content about-modal">
                <div class="modal-header">
                    <div class="about-logo"><img src="/admin/logo-mid.png" alt="dotStar Technologies"></div>
                    <button class="modal-close" onclick="closeAboutModal()">‚úï</button>
                </div>
                <div class="modal-body about-body">
                    <h2 class="about-title">MQTT SQL Admin</h2>
                    <div class="about-info">
                        <p>A web-based admin interface for MQTT message persistence with libSQL</p>
                    </div>
                    <div id="aboutVersion" class="about-version"></div>
                    <div class="about-separator"></div>
                    <div class="about-row">
                        <span class="about-label">GitHub:</span>
                        <a href="https://github.com/dotstartech/mqtt-sql-admin" target="_blank" class="about-link">github.com/dotstartech/mqtt-sql-admin</a>
                    </div>
                    <div class="about-row">
                        <span class="about-label">License:</span>
                        <span class="about-value">Apache License 2.0</span>
                    </div>
                    <div class="about-separator"></div>
                    <div class="about-shortcuts">
                        <div class="about-label">Keyboard Shortcuts:</div>
                        <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Enter</kbd> Execute query / Refresh</div>
                        <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>1</kbd>/<kbd>2</kbd>/<kbd>3</kbd> Switch tabs</div>
                        <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>R</kbd> Toggle auto-refresh</div>
                        <div class="shortcut-row"><kbd>Esc</kbd> Close dialogs</div>
                    </div>
                    <div class="about-separator"></div>
                    <div class="about-copyright">¬© 2025 dotStar Technologies B.V.</div>
                </div>
            </div>
        </div>
        <div class="tabs">
            <button class="tab active" onclick="switchTab('database')"><span id="dbStatusIcon" class="tab-status">‚ö´</span> Database</button>
            <button class="tab" onclick="switchTab('broker')"><span id="mqttStatusIcon" class="tab-status">‚ö´</span> Broker</button>
            <button class="tab" onclick="switchTab('acl')">ACL</button>
        </div>
        <div id="database-tab" class="tab-content active">
        <div class="controls">
            <div class="controls-left">
                <div class="control-group">
                    <label for="topicFilter">Topic Filter</label>
                    <input type="text" id="topicFilter" placeholder="data/test/%">
                </div>
                <div class="control-group">
                    <label for="timeFilter">Time Range</label>
                    <select id="timeFilter">
                        <option value="all">All Time</option>
                        <option value="1">24 Hours</option>
                        <option value="2" selected>2 Days</option>
                        <option value="3">3 Days</option>
                        <option value="5">5 Days</option>
                        <option value="7">7 Days</option>
                        <option value="30">30 Days</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="limit">Limit</label>
                    <select id="limit">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="500">500</option>
                        <option value="1000">1000</option>
                    </select>
                </div>
                <div class="control-group checkbox-group">
                    <span class="checkbox-label">Auto-Refresh</span>
                    <input type="checkbox" id="autoRefreshCheckbox" onchange="toggleAutoRefresh()">
                </div>
                <button onclick="loadMessages()">Apply</button>
                <button onclick="clearFilter()">Clear</button>
                <div class="separator-vertical"></div>
                <div class="control-group flex-grow">
                    <label for="customQuery">Custom Query</label>
                    <input type="text" id="customQuery" placeholder="SELECT topic, payload, ulid FROM msg WHERE ...">
                </div>
                <button id="executeBtn" onclick="executeCustomQuery()">Execute</button>
            </div>
        </div>
        <div class="content">
            <div id="message"></div>
            <div id="results"></div>
        </div>
    </div>
    <div id="acl-tab" class="tab-content">
        <div class="content">
            <div class="broker-section">
                <h3>üìã Clients</h3>
                <div class="broker-content">
                    <table class="acl-table" id="clients-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Display Name</th>
                                <th>Roles</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="broker-section">
                <h3>üîê Roles & ACLs</h3>
                <div class="broker-content">
                    <table class="acl-table" id="roles-table">
                        <thead>
                            <tr>
                                <th>Role Name</th>
                                <th>ACL Count</th>
                                <th>ACLs</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="broker-section">
                <h3>‚öôÔ∏è Default ACL Access</h3>
                <div class="broker-content">
                    <div id="default-acl"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="broker-tab" class="tab-content">
        <div class="controls">
            <div class="controls-left">
                <div class="control-group">
                    <label for="brokerTopicFilter">Topic Filter</label>
                    <input type="text" id="brokerTopicFilter" placeholder="e.g. data/+/state or sensors/#">
                </div>
                <div class="control-group">
                    <label for="brokerTimeFilter">Time Range</label>
                    <select id="brokerTimeFilter">
                        <option value="all">All Time</option>
                        <option value="5">5 Minutes</option>
                        <option value="15">15 Minutes</option>
                        <option value="30">30 Minutes</option>
                        <option value="60">1 Hour</option>
                        <option value="180" selected>3 Hours</option>
                        <option value="360">6 Hours</option>
                        <option value="1440">1 Day</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="brokerLimit">Limit</label>
                    <select id="brokerLimit">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50" >50</option>
                        <option value="100">100</option>
                        <option value="500">500</option>
                        <option value="1000">1000</option>
                    </select>
                </div>
                <div class="control-group checkbox-group">
                    <span class="checkbox-label">Retained</span>
                    <input type="checkbox" id="persistentOnlyFilter">
                </div>
                <button id="applyFilterBtn">Apply</button>
                <button onclick="clearMqttMessages()">Clear</button>
                <div class="separator-vertical"></div>
                <div class="control-group">
                    <label for="publishTopic">Topic</label>
                    <input type="text" id="publishTopic" placeholder="e.g. sensors/temperature">
                </div>
                <div class="control-group">
                    <label for="publishMessage">Message</label>
                    <input type="text" id="publishMessage" placeholder="Payload content">
                </div>
                <div class="control-group checkbox-group">
                    <span class="checkbox-label">Retained</span>
                    <input type="checkbox" id="publishRetained">
                </div>
                <div class="control-group">
                    <label for="publishQos">QoS</label>
                    <select id="publishQos">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                    </select>
                </div>
                <button onclick="publishMessage()">Send</button>
            </div>
        </div>
        <div class="content">
            <div id="results">
                <table id="mqtt-messages-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Topic</th>
                            <th>Payload</th>
                            <th>Headers</th>
                            <th>Retained</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
</html>

