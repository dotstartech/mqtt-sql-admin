# Admin static files (CSS, JS, etc.)
location /admin/ {
    # Proxy to the Docker container's internal nginx (port 8080)
    proxy_pass http://localhost:8080/admin/;
    
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# Admin interface endpoint
location /msg-admin {
    # Proxy to the Docker container's internal nginx (port 8080)
    proxy_pass http://localhost:8080/msg-admin;

    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# Database admin API endpoint
location /db-admin/ {
    # Proxy to the Docker container's internal nginx (port 8080)
    proxy_pass http://localhost:8080/db-admin/;

    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# Broker config endpoint
location /broker-config {
    # Proxy to the Docker container's internal nginx (port 8080)
    proxy_pass http://localhost:8080/broker-config;

    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# MQTT WebSocket endpoint
location /mqtt {
    # Proxy to the Docker container's internal nginx (port 8080)
    # No trailing slash - forward the path as-is
    proxy_pass http://localhost:8080/mqtt;

    # WebSocket upgrade headers
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;

    # Forward client information
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Long timeout for WebSocket connections (24 hours)
    proxy_read_timeout 86400s;
    proxy_send_timeout 86400s;

    # Disable buffering for WebSocket
    proxy_buffering off;
}

# MQTT credentials endpoint
location /mqtt-credentials {
    # Proxy to the Docker container's internal nginx (port 8080)
    proxy_pass http://localhost:8080/mqtt-credentials;

    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}